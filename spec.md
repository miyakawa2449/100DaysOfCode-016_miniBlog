# ミニブログ仕様書（修正版）

---

## 1. 初期設定

- サイト公開前に1回のみ実行
- 以下の情報を登録
  - 管理者ユーザ（email, name, パスワード）
  - サイトタイトル、サブタイトル
  - トップページのヘッダー画像、ロゴ画像
  - サイトURL
- 初期設定完了後、この機能は利用不可
- 運用開始後の情報更新は「サイト管理」「ユーザ管理」で行う

---

## 2. ユーザ管理・プロフィール

- ログイン・ログアウト機能
- パスワードリマインダ（パスワード再設定）機能
- Google Authenticator（TOTP）による2段階認証機能
  - ユーザごとにシークレットキーを発行・登録
  - QRコードでGoogle Authenticatorに登録
  - ログイン時に6桁コード入力による認証
- ユーザ情報  
  - email（ID兼用、ユニーク）  
  - name（本名）  
  - ハンドルネーム（公開用）  
  - パスワード（ハッシュ化保存）  
  - 紹介文（250文字以内）  
  - 出身地（10文字以内）  
  - 誕生日（yyyy年m月d日）  
  - SNSアカウント（X, Facebook, Instagram, Threads, YouTube）  
- プロフィールページ  
  - ハンドルネーム  
  - 投稿記事一覧  
  - 紹介文  
  - 出身地  
  - 誕生日  
  - SNSアカウント（登録があれば公開）

---

## 3. 公開ページ（一般ユーザ向け）

- ホーム（新着・人気記事一覧、OGP情報出力）
- カテゴリーページ（カテゴリ別記事一覧、階層対応、OGP情報出力）
- 記事ページ（タイトル、本文、アイキャッチ画像、記事内画像、SNS埋込、外部記事OGP埋込、要約、ディスクリプション、OGP情報出力）
- プロフィールページ（上記参照）

---

## 4. 管理画面（管理者・投稿者向け）

- ダッシュボード（統計情報、最近の投稿など）
- サイト管理  
  - サイトタイトル、サブタイトル  
  - サイトURL
  - トップページのヘッダー画像、ロゴ画像  
  - OGP用イメージ（トップページ用）  
  - サイト紹介文（OGP description用）
- ユーザ管理（ユーザ一覧、編集、削除）
- 記事管理（ブロック型エディタ方式）
  - 記事作成・編集・削除
  - 記事タイトル
  - アイキャッチ画像ブロック（16:9、800px、記事先頭専用）
  - 記事本文は「ブロック」のリストとして管理
    - テキストブロック（Markdown対応）
    - 画像ブロック（1:1、400pxでトリミング・リサイズ）
    - SNS埋込ブロック（X, Facebook, Instagram, Threads, YouTube）
    - 外部記事埋込ブロック（URL入力でOGPカード化）
  - ブロックの追加・削除・並び替えが可能
  - SNSや外部記事はURLを入力すると自動で埋込ブロックに変換
  - 記事要約、ディスクリプション
  - 記事URL（スラッグ指定、例: http://hogehoge.com/xxxxxx の xxxxxx 部分を指定）
  - カテゴリー選択・新規作成・子カテゴリ追加
  - 公開ステータス（下書き/公開/公開日時指定）
  - 記事編集時にプレビュー機能を提供
    - 編集内容を新しいウィンドウまたはタブで実際の公開イメージとして確認できる
    - プレビューは下書き状態でも利用可能
- カテゴリー管理  
  - カテゴリーの作成・編集・削除  
  - カテゴリー名、親子関係（階層構造）  
  - カテゴリーURL（スラッグ）  
  - カテゴリー紹介文（OGP description用）  
  - カテゴリーOGP画像

---

## 5. 技術スタック・その他

- Python, Flask, Jinja2, Bootstrap
- 画像処理：Pillow（トリミング・リサイズ）
- Markdown対応
- データベース：SQLiteまたは他RDBMS
- 認証：Flask-Login等
- 画像アップロード時の自動トリミング・リサイズ
- OGP情報の各ページでの動的出力（title, description, image, url）
- SNS・外部記事埋込はカード形式等で表示
- 記事本文はブロックの配列としてDBに保存（順序情報を保持）

---

# 仕様確定後の進め方

---

## 1. 画面遷移図の作成

- 必要な画面（ページ）を洗い出し、どの画面からどこへ遷移できるかを図で整理する
- 画面の全体像や必要なページを可視化し、抜け漏れ防止や実装計画に役立てる

---

## 2. データベース設計

- 仕様書をもとに、必要なテーブル・カラム・リレーションを設計する
- 画面遷移図と合わせて、どの画面でどのデータが必要かも確認する

---

## 3. 仕様書への変数名・型の明記

- 仕様書に「この項目はDBのどのカラムか」「画面上の変数名は何か」などを追記する
- 実装時の迷いを減らし、設計と実装の齟齬を防ぐ

---

## 4. ユースケース図（必要に応じて）

- 複数人開発や要件の複雑化が予想される場合は、ユースケース図があると役立つ
- 今回の規模なら必須ではないが、「誰が・どの機能を・どのように使うか」を整理したい場合は作成をおすすめ

---

## おすすめの進め方

1. 画面遷移図を作成し、全体像を可視化
2. データベース設計を行い、必要なデータ構造を明確化
3. 仕様書に変数名や型を追記し、実装時の参照用にする
4. 必要に応じてユースケース図を作成し、利用者視点での機能整理を行う

---